<!-- Payment details -->
<iframe id="hostedFields" src="/hosted/fields" sandbox="allow-scripts allow-same-origin"></iframe>

<script>
  const API_BASE = window.location.origin; // e.g., http://localhost:4242

  function setupHostedFields() {
    window.addEventListener('message', (evt) => {
      // Only accept messages from our own origin
      if (evt.origin !== API_BASE) return;
      const { type, payload } = evt.data || {};
      if (type === 'vaultedToken') {
        paymentToken = payload.token;
        setMsg(`Payment token ready: ${paymentToken.slice(0, 8)}â€¦`);
      } else if (type === 'hostedReady') {
        document.getElementById('hostedFields').contentWindow.postMessage({ type: 'tokenize' }, API_BASE);
      } else if (type === 'error') {
        setMsg(payload.message || 'Hosted fields error', false);
      }
    });
  }
</script>
